{"version":3,"sources":["webpack:///webpack/bootstrap 30cc65f21f6034b43699","webpack:///./lib/workers/cam-raster.js","webpack:///./lib/lw.raster2gcode/canvas-filters.js","webpack:///./lib/lw.raster2gcode/canvas-grid.js","webpack:///./lib/lw.raster2gcode/raster-to-gcode.js","webpack:///../~/floyd-steinberg/floyd-steinberg.js"],"names":["self","onmessage","event","data","cmd","start","rasterToGcode","settings","Object","assign","properties","on","postMessage","run","grayscaleAlgorithms","color","invertColor","i","value","brightness","undefined","contrast","gamma","Math","exp","log","grayscale","algorithm","shades","indexOf","Error","gray","r","g","b","max","min","parseInt","canvasFilters","canvas","smoothing","shadesOfGray","dithering","context","getContext","imageSmoothingEnabled","mozImageSmoothingEnabled","webkitImageSmoothingEnabled","msImageSmoothingEnabled","oImageSmoothingEnabled","imageData","getImageData","width","height","contrastFactor","brightnessOffset","gammaCorrection","shadesOfGrayFactor","il","length","putImageData","CanvasGrid","constructor","cellSize","scaleRatio","x","y","filters","size","cols","rows","file","image","url","pixels","load","input","File","loadFromFile","Image","loadFromImage","URL","loadFromURL","trim","Promise","reject","_loadImage","src","resolve","onload","then","catch","onerror","createObjectURL","_processImage","round","ceil","line","sx","sy","sw","sh","document","createElement","fillStyle","fillRect","drawImage","push","getPixel","isNaN","col","row","pixelData","slice","a","grid","coords","RasterToGcode","ppi","toolDiameter","rapidRate","feedRate","rateUnit","beamRange","beamPower","milling","zSafe","zSurface","zDepth","passDepth","offsets","X","Y","trimLine","joinPixel","burnWhite","verboseG","diagonal","overscan","precision","S","nonBlocking","onProgress","onProgressContext","onDone","onDoneContext","onAbort","onAbortContext","passes","abs","floor","ppm","parseFloat","toFixed","running","gcode","gcodes","currentLine","lastCommands","outputSize","G1","G0","beamOffset","realBeamRange","_registerUserCallbacks","callbacks","abort","_addHeader","_scanDiagonally","_scanHorizontally","options","splice","join","_mapPixelPower","range","_command","name","commands","Array","prototype","call","arguments","command","apply","_getPixelPower","defaultValue","pixel","error","_getPoint","index","point","G","s","first","lastWhite","last","lastColored","_trimCurrentLine","p","shift","pop","_reduceCurrentLine","points","power","_overscanCurrentLine","reversed","firstPoint","lastPoint","rightPoint","leftPoint","unshift","_processCurrentLine","_processMillingLine","_processLaserLine","reverse","addCommand","plung","Z","zMax","pass","passNum","w","h","computeCurrentLine","percent","lastPercent","processCurrentLine","_onProgress","processNextLine","_onAbort","setTimeout","forEach","_onDone","totalLines","lineNum","callback","method","toUpperCase","getHeightMap","heightMap"],"mappings":";AAAA;AACA;AACA;AACA,mCAA2B;AAC3B;AACA,YAAI;AACJ;AACA,WAAG;AACH;AACA;;AAEA;AACA,sDAA8C;AAC9C;AACA,qCAA6B;;AAE7B,+CAAuC;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAM;AACN,aAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAS;AACT;AACA;AACA;AACA;AACA,eAAO;AACP,cAAM;AACN;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAM;AACN;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;AACA;AACA;AACA;AACA,aAAK;AACL,YAAI;AACJ;AACA;AACA;AACA;;AAEA,8CAAsC;AACtC;AACA;AACA,qCAA6B;AAC7B,qCAA6B;AAC7B;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAAoB,gBAAgB;AACpC;AACA;AACA;AACA,aAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,4BAAoB,gBAAgB;AACpC;AACA,aAAK;AACL;AACA;AACA,aAAK;AACL;AACA;AACA,aAAK;AACL;AACA;AACA;AACA,aAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;AACA,aAAK;AACL;AACA;AACA;AACA,aAAK;;AAEL;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,yBAAiB,8BAA8B;AAC/C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,YAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,0BAAkB,qBAAqB;AACvC;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,YAAI;AACJ;;AAEA,4DAAoD;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,YAAI;AACJ;AACA;AACA;AACA,YAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAAmB,2BAA2B;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,0BAAkB,cAAc;AAChC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,yBAAiB,4BAA4B;AAC7C;AACA;AACA;AACA;AACA;AACA,cAAM;AACN;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,0BAAkB,4BAA4B;AAC9C;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,0BAAkB,4BAA4B;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,2BAAmB,uCAAuC;AAC1D;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAAmB,uCAAuC;AAC1D;AACA;AACA;AACA;AACA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","file":"30cc65f21f6034b43699.worker.js","sourcesContent":[" \t// Copied from https://github.com/facebook/react/blob/bef45b0/src/shared/utils/canDefineProperty.js\r\n \tvar canDefineProperty = false;\r\n \ttry {\r\n \t\tObject.defineProperty({}, \"x\", {\r\n \t\t\tget: function() {}\r\n \t\t});\r\n \t\tcanDefineProperty = true;\r\n \t} catch(x) {\r\n \t\t// IE will fail on defineProperty\r\n \t}\r\n \t\r\n \tvar hotApplyOnUpdate = true;\r\n \tvar hotCurrentHash = \"30cc65f21f6034b43699\"; // eslint-disable-line no-unused-vars\r\n \tvar hotCurrentModuleData = {};\r\n \tvar hotCurrentParents = []; // eslint-disable-line no-unused-vars\r\n \t\r\n \tfunction hotCreateRequire(moduleId) { // eslint-disable-line no-unused-vars\r\n \t\tvar me = installedModules[moduleId];\r\n \t\tif(!me) return __webpack_require__;\r\n \t\tvar fn = function(request) {\r\n \t\t\tif(me.hot.active) {\r\n \t\t\t\tif(installedModules[request]) {\r\n \t\t\t\t\tif(installedModules[request].parents.indexOf(moduleId) < 0)\r\n \t\t\t\t\t\tinstalledModules[request].parents.push(moduleId);\r\n \t\t\t\t\tif(me.children.indexOf(request) < 0)\r\n \t\t\t\t\t\tme.children.push(request);\r\n \t\t\t\t} else hotCurrentParents = [moduleId];\r\n \t\t\t} else {\r\n \t\t\t\tconsole.warn(\"[HMR] unexpected require(\" + request + \") from disposed module \" + moduleId);\r\n \t\t\t\thotCurrentParents = [];\r\n \t\t\t}\r\n \t\t\treturn __webpack_require__(request);\r\n \t\t};\r\n \t\tfor(var name in __webpack_require__) {\r\n \t\t\tif(Object.prototype.hasOwnProperty.call(__webpack_require__, name)) {\r\n \t\t\t\tif(canDefineProperty) {\r\n \t\t\t\t\tObject.defineProperty(fn, name, (function(name) {\r\n \t\t\t\t\t\treturn {\r\n \t\t\t\t\t\t\tconfigurable: true,\r\n \t\t\t\t\t\t\tenumerable: true,\r\n \t\t\t\t\t\t\tget: function() {\r\n \t\t\t\t\t\t\t\treturn __webpack_require__[name];\r\n \t\t\t\t\t\t\t},\r\n \t\t\t\t\t\t\tset: function(value) {\r\n \t\t\t\t\t\t\t\t__webpack_require__[name] = value;\r\n \t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t};\r\n \t\t\t\t\t}(name)));\r\n \t\t\t\t} else {\r\n \t\t\t\t\tfn[name] = __webpack_require__[name];\r\n \t\t\t\t}\r\n \t\t\t}\r\n \t\t}\r\n \t\r\n \t\tfunction ensure(chunkId, callback) {\r\n \t\t\tif(hotStatus === \"ready\")\r\n \t\t\t\thotSetStatus(\"prepare\");\r\n \t\t\thotChunksLoading++;\r\n \t\t\t__webpack_require__.e(chunkId, function() {\r\n \t\t\t\ttry {\r\n \t\t\t\t\tcallback.call(null, fn);\r\n \t\t\t\t} finally {\r\n \t\t\t\t\tfinishChunkLoading();\r\n \t\t\t\t}\r\n \t\r\n \t\t\t\tfunction finishChunkLoading() {\r\n \t\t\t\t\thotChunksLoading--;\r\n \t\t\t\t\tif(hotStatus === \"prepare\") {\r\n \t\t\t\t\t\tif(!hotWaitingFilesMap[chunkId]) {\r\n \t\t\t\t\t\t\thotEnsureUpdateChunk(chunkId);\r\n \t\t\t\t\t\t}\r\n \t\t\t\t\t\tif(hotChunksLoading === 0 && hotWaitingFiles === 0) {\r\n \t\t\t\t\t\t\thotUpdateDownloaded();\r\n \t\t\t\t\t\t}\r\n \t\t\t\t\t}\r\n \t\t\t\t}\r\n \t\t\t});\r\n \t\t}\r\n \t\tif(canDefineProperty) {\r\n \t\t\tObject.defineProperty(fn, \"e\", {\r\n \t\t\t\tenumerable: true,\r\n \t\t\t\tvalue: ensure\r\n \t\t\t});\r\n \t\t} else {\r\n \t\t\tfn.e = ensure;\r\n \t\t}\r\n \t\treturn fn;\r\n \t}\r\n \t\r\n \tfunction hotCreateModule(moduleId) { // eslint-disable-line no-unused-vars\r\n \t\tvar hot = {\r\n \t\t\t// private stuff\r\n \t\t\t_acceptedDependencies: {},\r\n \t\t\t_declinedDependencies: {},\r\n \t\t\t_selfAccepted: false,\r\n \t\t\t_selfDeclined: false,\r\n \t\t\t_disposeHandlers: [],\r\n \t\r\n \t\t\t// Module API\r\n \t\t\tactive: true,\r\n \t\t\taccept: function(dep, callback) {\r\n \t\t\t\tif(typeof dep === \"undefined\")\r\n \t\t\t\t\thot._selfAccepted = true;\r\n \t\t\t\telse if(typeof dep === \"function\")\r\n \t\t\t\t\thot._selfAccepted = dep;\r\n \t\t\t\telse if(typeof dep === \"object\")\r\n \t\t\t\t\tfor(var i = 0; i < dep.length; i++)\r\n \t\t\t\t\t\thot._acceptedDependencies[dep[i]] = callback;\r\n \t\t\t\telse\r\n \t\t\t\t\thot._acceptedDependencies[dep] = callback;\r\n \t\t\t},\r\n \t\t\tdecline: function(dep) {\r\n \t\t\t\tif(typeof dep === \"undefined\")\r\n \t\t\t\t\thot._selfDeclined = true;\r\n \t\t\t\telse if(typeof dep === \"number\")\r\n \t\t\t\t\thot._declinedDependencies[dep] = true;\r\n \t\t\t\telse\r\n \t\t\t\t\tfor(var i = 0; i < dep.length; i++)\r\n \t\t\t\t\t\thot._declinedDependencies[dep[i]] = true;\r\n \t\t\t},\r\n \t\t\tdispose: function(callback) {\r\n \t\t\t\thot._disposeHandlers.push(callback);\r\n \t\t\t},\r\n \t\t\taddDisposeHandler: function(callback) {\r\n \t\t\t\thot._disposeHandlers.push(callback);\r\n \t\t\t},\r\n \t\t\tremoveDisposeHandler: function(callback) {\r\n \t\t\t\tvar idx = hot._disposeHandlers.indexOf(callback);\r\n \t\t\t\tif(idx >= 0) hot._disposeHandlers.splice(idx, 1);\r\n \t\t\t},\r\n \t\r\n \t\t\t// Management API\r\n \t\t\tcheck: hotCheck,\r\n \t\t\tapply: hotApply,\r\n \t\t\tstatus: function(l) {\r\n \t\t\t\tif(!l) return hotStatus;\r\n \t\t\t\thotStatusHandlers.push(l);\r\n \t\t\t},\r\n \t\t\taddStatusHandler: function(l) {\r\n \t\t\t\thotStatusHandlers.push(l);\r\n \t\t\t},\r\n \t\t\tremoveStatusHandler: function(l) {\r\n \t\t\t\tvar idx = hotStatusHandlers.indexOf(l);\r\n \t\t\t\tif(idx >= 0) hotStatusHandlers.splice(idx, 1);\r\n \t\t\t},\r\n \t\r\n \t\t\t//inherit from previous dispose call\r\n \t\t\tdata: hotCurrentModuleData[moduleId]\r\n \t\t};\r\n \t\treturn hot;\r\n \t}\r\n \t\r\n \tvar hotStatusHandlers = [];\r\n \tvar hotStatus = \"idle\";\r\n \t\r\n \tfunction hotSetStatus(newStatus) {\r\n \t\thotStatus = newStatus;\r\n \t\tfor(var i = 0; i < hotStatusHandlers.length; i++)\r\n \t\t\thotStatusHandlers[i].call(null, newStatus);\r\n \t}\r\n \t\r\n \t// while downloading\r\n \tvar hotWaitingFiles = 0;\r\n \tvar hotChunksLoading = 0;\r\n \tvar hotWaitingFilesMap = {};\r\n \tvar hotRequestedFilesMap = {};\r\n \tvar hotAvailibleFilesMap = {};\r\n \tvar hotCallback;\r\n \t\r\n \t// The update info\r\n \tvar hotUpdate, hotUpdateNewHash;\r\n \t\r\n \tfunction toModuleId(id) {\r\n \t\tvar isNumber = (+id) + \"\" === id;\r\n \t\treturn isNumber ? +id : id;\r\n \t}\r\n \t\r\n \tfunction hotCheck(apply, callback) {\r\n \t\tif(hotStatus !== \"idle\") throw new Error(\"check() is only allowed in idle status\");\r\n \t\tif(typeof apply === \"function\") {\r\n \t\t\thotApplyOnUpdate = false;\r\n \t\t\tcallback = apply;\r\n \t\t} else {\r\n \t\t\thotApplyOnUpdate = apply;\r\n \t\t\tcallback = callback || function(err) {\r\n \t\t\t\tif(err) throw err;\r\n \t\t\t};\r\n \t\t}\r\n \t\thotSetStatus(\"check\");\r\n \t\thotDownloadManifest(function(err, update) {\r\n \t\t\tif(err) return callback(err);\r\n \t\t\tif(!update) {\r\n \t\t\t\thotSetStatus(\"idle\");\r\n \t\t\t\tcallback(null, null);\r\n \t\t\t\treturn;\r\n \t\t\t}\r\n \t\r\n \t\t\thotRequestedFilesMap = {};\r\n \t\t\thotAvailibleFilesMap = {};\r\n \t\t\thotWaitingFilesMap = {};\r\n \t\t\tfor(var i = 0; i < update.c.length; i++)\r\n \t\t\t\thotAvailibleFilesMap[update.c[i]] = true;\r\n \t\t\thotUpdateNewHash = update.h;\r\n \t\r\n \t\t\thotSetStatus(\"prepare\");\r\n \t\t\thotCallback = callback;\r\n \t\t\thotUpdate = {};\r\n \t\t\tvar chunkId = 0;\r\n \t\t\t{ // eslint-disable-line no-lone-blocks\r\n \t\t\t\t/*globals chunkId */\r\n \t\t\t\thotEnsureUpdateChunk(chunkId);\r\n \t\t\t}\r\n \t\t\tif(hotStatus === \"prepare\" && hotChunksLoading === 0 && hotWaitingFiles === 0) {\r\n \t\t\t\thotUpdateDownloaded();\r\n \t\t\t}\r\n \t\t});\r\n \t}\r\n \t\r\n \tfunction hotAddUpdateChunk(chunkId, moreModules) { // eslint-disable-line no-unused-vars\r\n \t\tif(!hotAvailibleFilesMap[chunkId] || !hotRequestedFilesMap[chunkId])\r\n \t\t\treturn;\r\n \t\thotRequestedFilesMap[chunkId] = false;\r\n \t\tfor(var moduleId in moreModules) {\r\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\r\n \t\t\t\thotUpdate[moduleId] = moreModules[moduleId];\r\n \t\t\t}\r\n \t\t}\r\n \t\tif(--hotWaitingFiles === 0 && hotChunksLoading === 0) {\r\n \t\t\thotUpdateDownloaded();\r\n \t\t}\r\n \t}\r\n \t\r\n \tfunction hotEnsureUpdateChunk(chunkId) {\r\n \t\tif(!hotAvailibleFilesMap[chunkId]) {\r\n \t\t\thotWaitingFilesMap[chunkId] = true;\r\n \t\t} else {\r\n \t\t\thotRequestedFilesMap[chunkId] = true;\r\n \t\t\thotWaitingFiles++;\r\n \t\t\thotDownloadUpdateChunk(chunkId);\r\n \t\t}\r\n \t}\r\n \t\r\n \tfunction hotUpdateDownloaded() {\r\n \t\thotSetStatus(\"ready\");\r\n \t\tvar callback = hotCallback;\r\n \t\thotCallback = null;\r\n \t\tif(!callback) return;\r\n \t\tif(hotApplyOnUpdate) {\r\n \t\t\thotApply(hotApplyOnUpdate, callback);\r\n \t\t} else {\r\n \t\t\tvar outdatedModules = [];\r\n \t\t\tfor(var id in hotUpdate) {\r\n \t\t\t\tif(Object.prototype.hasOwnProperty.call(hotUpdate, id)) {\r\n \t\t\t\t\toutdatedModules.push(toModuleId(id));\r\n \t\t\t\t}\r\n \t\t\t}\r\n \t\t\tcallback(null, outdatedModules);\r\n \t\t}\r\n \t}\r\n \t\r\n \tfunction hotApply(options, callback) {\r\n \t\tif(hotStatus !== \"ready\") throw new Error(\"apply() is only allowed in ready status\");\r\n \t\tif(typeof options === \"function\") {\r\n \t\t\tcallback = options;\r\n \t\t\toptions = {};\r\n \t\t} else if(options && typeof options === \"object\") {\r\n \t\t\tcallback = callback || function(err) {\r\n \t\t\t\tif(err) throw err;\r\n \t\t\t};\r\n \t\t} else {\r\n \t\t\toptions = {};\r\n \t\t\tcallback = callback || function(err) {\r\n \t\t\t\tif(err) throw err;\r\n \t\t\t};\r\n \t\t}\r\n \t\r\n \t\tfunction getAffectedStuff(module) {\r\n \t\t\tvar outdatedModules = [module];\r\n \t\t\tvar outdatedDependencies = {};\r\n \t\r\n \t\t\tvar queue = outdatedModules.slice();\r\n \t\t\twhile(queue.length > 0) {\r\n \t\t\t\tvar moduleId = queue.pop();\r\n \t\t\t\tvar module = installedModules[moduleId];\r\n \t\t\t\tif(!module || module.hot._selfAccepted)\r\n \t\t\t\t\tcontinue;\r\n \t\t\t\tif(module.hot._selfDeclined) {\r\n \t\t\t\t\treturn new Error(\"Aborted because of self decline: \" + moduleId);\r\n \t\t\t\t}\r\n \t\t\t\tif(moduleId === 0) {\r\n \t\t\t\t\treturn;\r\n \t\t\t\t}\r\n \t\t\t\tfor(var i = 0; i < module.parents.length; i++) {\r\n \t\t\t\t\tvar parentId = module.parents[i];\r\n \t\t\t\t\tvar parent = installedModules[parentId];\r\n \t\t\t\t\tif(parent.hot._declinedDependencies[moduleId]) {\r\n \t\t\t\t\t\treturn new Error(\"Aborted because of declined dependency: \" + moduleId + \" in \" + parentId);\r\n \t\t\t\t\t}\r\n \t\t\t\t\tif(outdatedModules.indexOf(parentId) >= 0) continue;\r\n \t\t\t\t\tif(parent.hot._acceptedDependencies[moduleId]) {\r\n \t\t\t\t\t\tif(!outdatedDependencies[parentId])\r\n \t\t\t\t\t\t\toutdatedDependencies[parentId] = [];\r\n \t\t\t\t\t\taddAllToSet(outdatedDependencies[parentId], [moduleId]);\r\n \t\t\t\t\t\tcontinue;\r\n \t\t\t\t\t}\r\n \t\t\t\t\tdelete outdatedDependencies[parentId];\r\n \t\t\t\t\toutdatedModules.push(parentId);\r\n \t\t\t\t\tqueue.push(parentId);\r\n \t\t\t\t}\r\n \t\t\t}\r\n \t\r\n \t\t\treturn [outdatedModules, outdatedDependencies];\r\n \t\t}\r\n \t\r\n \t\tfunction addAllToSet(a, b) {\r\n \t\t\tfor(var i = 0; i < b.length; i++) {\r\n \t\t\t\tvar item = b[i];\r\n \t\t\t\tif(a.indexOf(item) < 0)\r\n \t\t\t\t\ta.push(item);\r\n \t\t\t}\r\n \t\t}\r\n \t\r\n \t\t// at begin all updates modules are outdated\r\n \t\t// the \"outdated\" status can propagate to parents if they don't accept the children\r\n \t\tvar outdatedDependencies = {};\r\n \t\tvar outdatedModules = [];\r\n \t\tvar appliedUpdate = {};\r\n \t\tfor(var id in hotUpdate) {\r\n \t\t\tif(Object.prototype.hasOwnProperty.call(hotUpdate, id)) {\r\n \t\t\t\tvar moduleId = toModuleId(id);\r\n \t\t\t\tvar result = getAffectedStuff(moduleId);\r\n \t\t\t\tif(!result) {\r\n \t\t\t\t\tif(options.ignoreUnaccepted)\r\n \t\t\t\t\t\tcontinue;\r\n \t\t\t\t\thotSetStatus(\"abort\");\r\n \t\t\t\t\treturn callback(new Error(\"Aborted because \" + moduleId + \" is not accepted\"));\r\n \t\t\t\t}\r\n \t\t\t\tif(result instanceof Error) {\r\n \t\t\t\t\thotSetStatus(\"abort\");\r\n \t\t\t\t\treturn callback(result);\r\n \t\t\t\t}\r\n \t\t\t\tappliedUpdate[moduleId] = hotUpdate[moduleId];\r\n \t\t\t\taddAllToSet(outdatedModules, result[0]);\r\n \t\t\t\tfor(var moduleId in result[1]) {\r\n \t\t\t\t\tif(Object.prototype.hasOwnProperty.call(result[1], moduleId)) {\r\n \t\t\t\t\t\tif(!outdatedDependencies[moduleId])\r\n \t\t\t\t\t\t\toutdatedDependencies[moduleId] = [];\r\n \t\t\t\t\t\taddAllToSet(outdatedDependencies[moduleId], result[1][moduleId]);\r\n \t\t\t\t\t}\r\n \t\t\t\t}\r\n \t\t\t}\r\n \t\t}\r\n \t\r\n \t\t// Store self accepted outdated modules to require them later by the module system\r\n \t\tvar outdatedSelfAcceptedModules = [];\r\n \t\tfor(var i = 0; i < outdatedModules.length; i++) {\r\n \t\t\tvar moduleId = outdatedModules[i];\r\n \t\t\tif(installedModules[moduleId] && installedModules[moduleId].hot._selfAccepted)\r\n \t\t\t\toutdatedSelfAcceptedModules.push({\r\n \t\t\t\t\tmodule: moduleId,\r\n \t\t\t\t\terrorHandler: installedModules[moduleId].hot._selfAccepted\r\n \t\t\t\t});\r\n \t\t}\r\n \t\r\n \t\t// Now in \"dispose\" phase\r\n \t\thotSetStatus(\"dispose\");\r\n \t\tvar queue = outdatedModules.slice();\r\n \t\twhile(queue.length > 0) {\r\n \t\t\tvar moduleId = queue.pop();\r\n \t\t\tvar module = installedModules[moduleId];\r\n \t\t\tif(!module) continue;\r\n \t\r\n \t\t\tvar data = {};\r\n \t\r\n \t\t\t// Call dispose handlers\r\n \t\t\tvar disposeHandlers = module.hot._disposeHandlers;\r\n \t\t\tfor(var j = 0; j < disposeHandlers.length; j++) {\r\n \t\t\t\tvar cb = disposeHandlers[j];\r\n \t\t\t\tcb(data);\r\n \t\t\t}\r\n \t\t\thotCurrentModuleData[moduleId] = data;\r\n \t\r\n \t\t\t// disable module (this disables requires from this module)\r\n \t\t\tmodule.hot.active = false;\r\n \t\r\n \t\t\t// remove module from cache\r\n \t\t\tdelete installedModules[moduleId];\r\n \t\r\n \t\t\t// remove \"parents\" references from all children\r\n \t\t\tfor(var j = 0; j < module.children.length; j++) {\r\n \t\t\t\tvar child = installedModules[module.children[j]];\r\n \t\t\t\tif(!child) continue;\r\n \t\t\t\tvar idx = child.parents.indexOf(moduleId);\r\n \t\t\t\tif(idx >= 0) {\r\n \t\t\t\t\tchild.parents.splice(idx, 1);\r\n \t\t\t\t}\r\n \t\t\t}\r\n \t\t}\r\n \t\r\n \t\t// remove outdated dependency from module children\r\n \t\tfor(var moduleId in outdatedDependencies) {\r\n \t\t\tif(Object.prototype.hasOwnProperty.call(outdatedDependencies, moduleId)) {\r\n \t\t\t\tvar module = installedModules[moduleId];\r\n \t\t\t\tvar moduleOutdatedDependencies = outdatedDependencies[moduleId];\r\n \t\t\t\tfor(var j = 0; j < moduleOutdatedDependencies.length; j++) {\r\n \t\t\t\t\tvar dependency = moduleOutdatedDependencies[j];\r\n \t\t\t\t\tvar idx = module.children.indexOf(dependency);\r\n \t\t\t\t\tif(idx >= 0) module.children.splice(idx, 1);\r\n \t\t\t\t}\r\n \t\t\t}\r\n \t\t}\r\n \t\r\n \t\t// Not in \"apply\" phase\r\n \t\thotSetStatus(\"apply\");\r\n \t\r\n \t\thotCurrentHash = hotUpdateNewHash;\r\n \t\r\n \t\t// insert new code\r\n \t\tfor(var moduleId in appliedUpdate) {\r\n \t\t\tif(Object.prototype.hasOwnProperty.call(appliedUpdate, moduleId)) {\r\n \t\t\t\tmodules[moduleId] = appliedUpdate[moduleId];\r\n \t\t\t}\r\n \t\t}\r\n \t\r\n \t\t// call accept handlers\r\n \t\tvar error = null;\r\n \t\tfor(var moduleId in outdatedDependencies) {\r\n \t\t\tif(Object.prototype.hasOwnProperty.call(outdatedDependencies, moduleId)) {\r\n \t\t\t\tvar module = installedModules[moduleId];\r\n \t\t\t\tvar moduleOutdatedDependencies = outdatedDependencies[moduleId];\r\n \t\t\t\tvar callbacks = [];\r\n \t\t\t\tfor(var i = 0; i < moduleOutdatedDependencies.length; i++) {\r\n \t\t\t\t\tvar dependency = moduleOutdatedDependencies[i];\r\n \t\t\t\t\tvar cb = module.hot._acceptedDependencies[dependency];\r\n \t\t\t\t\tif(callbacks.indexOf(cb) >= 0) continue;\r\n \t\t\t\t\tcallbacks.push(cb);\r\n \t\t\t\t}\r\n \t\t\t\tfor(var i = 0; i < callbacks.length; i++) {\r\n \t\t\t\t\tvar cb = callbacks[i];\r\n \t\t\t\t\ttry {\r\n \t\t\t\t\t\tcb(outdatedDependencies);\r\n \t\t\t\t\t} catch(err) {\r\n \t\t\t\t\t\tif(!error)\r\n \t\t\t\t\t\t\terror = err;\r\n \t\t\t\t\t}\r\n \t\t\t\t}\r\n \t\t\t}\r\n \t\t}\r\n \t\r\n \t\t// Load self accepted modules\r\n \t\tfor(var i = 0; i < outdatedSelfAcceptedModules.length; i++) {\r\n \t\t\tvar item = outdatedSelfAcceptedModules[i];\r\n \t\t\tvar moduleId = item.module;\r\n \t\t\thotCurrentParents = [moduleId];\r\n \t\t\ttry {\r\n \t\t\t\t__webpack_require__(moduleId);\r\n \t\t\t} catch(err) {\r\n \t\t\t\tif(typeof item.errorHandler === \"function\") {\r\n \t\t\t\t\ttry {\r\n \t\t\t\t\t\titem.errorHandler(err);\r\n \t\t\t\t\t} catch(err) {\r\n \t\t\t\t\t\tif(!error)\r\n \t\t\t\t\t\t\terror = err;\r\n \t\t\t\t\t}\r\n \t\t\t\t} else if(!error)\r\n \t\t\t\t\terror = err;\r\n \t\t\t}\r\n \t\t}\r\n \t\r\n \t\t// handle errors in accept handlers and self accepted module load\r\n \t\tif(error) {\r\n \t\t\thotSetStatus(\"fail\");\r\n \t\t\treturn callback(error);\r\n \t\t}\r\n \t\r\n \t\thotSetStatus(\"idle\");\r\n \t\tcallback(null, outdatedModules);\r\n \t}\r\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false,\n \t\t\thot: hotCreateModule(moduleId),\n \t\t\tparents: hotCurrentParents,\n \t\t\tchildren: []\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, hotCreateRequire(moduleId));\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// __webpack_hash__\n \t__webpack_require__.h = function() { return hotCurrentHash; };\n\n \t// Load entry module and return exports\n \treturn hotCreateRequire(0)(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 30cc65f21f6034b43699","import { RasterToGcode } from '../lw.raster2gcode/raster-to-gcode.js'\r\n\r\n// On messsage received\r\nself.onmessage = function (event) {\r\n    if (event.data.cmd === 'start') {\r\n        start(event.data);\r\n    }\r\n}\r\n\r\n\r\n\r\n// Start job\r\nfunction start(data) {\r\n\r\n    // Create RasterToGcode object\r\n    var rasterToGcode = new RasterToGcode(data.settings);\r\n        Object.assign( rasterToGcode, data.properties );\r\n    // Register events callbacks\r\n        rasterToGcode.on('progress', function (event) {\r\n            self.postMessage({ event: 'onProgress', ...event });\r\n        }).on('done', function (event) {\r\n            self.postMessage({ event: 'onDone', ...event });\r\n        }).on('abort', function () {\r\n            self.postMessage({ event: 'onAbort' });\r\n        });\r\n\r\n    \r\n    self.postMessage({ event: 'start' });\r\n    rasterToGcode.run();\r\n\r\n}\n\n\n// WEBPACK FOOTER //\n// ./lib/workers/cam-raster.js","import FloydSteinberg from 'floyd-steinberg'\r\n\r\n// Grayscale algorithms\r\nconst grayscaleAlgorithms = [\r\n    'none',\r\n    'average',\r\n    'desaturation',\r\n    'decomposition-min', 'decomposition-max',\r\n    'luma', 'luma-601', 'luma-709', 'luma-240',\r\n    'red-chanel', 'green-chanel', 'blue-chanel'\r\n]\r\n\r\n// Trucate color value in the 0-255 range\r\nfunction color(color) {\r\n    return color < 0 ? 0 : (color > 255 ? 255 : color);\r\n}\r\n\r\n// Filters ...\r\nfunction invertColor(data, i, value) {\r\n    if (value) {\r\n        data[i]     = color(255 - data[i])\r\n        data[i + 1] = color(255 - data[i + 1])\r\n        data[i + 2] = color(255 - data[i + 2])\r\n    }\r\n}\r\n\r\nfunction brightness(data, i, value) {\r\n    if (value !== undefined) {\r\n        data[i]     = color(data[i]     + value)\r\n        data[i + 1] = color(data[i + 1] + value)\r\n        data[i + 2] = color(data[i + 2] + value)\r\n    }\r\n}\r\n\r\nfunction contrast(data, i, value) {\r\n    if (value !== undefined) {\r\n        data[i]     = color(value * (data[i]     - 128) + 128)\r\n        data[i + 1] = color(value * (data[i + 1] - 128) + 128)\r\n        data[i + 2] = color(value * (data[i + 2] - 128) + 128)\r\n    }\r\n}\r\n\r\nfunction gamma(data, i, value) {\r\n    if (value !== undefined) {\r\n        data[i]     = color(Math.exp(Math.log(255 * (data[i]     / 255)) * value))\r\n        data[i + 1] = color(Math.exp(Math.log(255 * (data[i + 1] / 255)) * value))\r\n        data[i + 2] = color(Math.exp(Math.log(255 * (data[i + 2] / 255)) * value))\r\n    }\r\n}\r\n\r\nfunction grayscale(data, i, algorithm, shades) {\r\n    // Graysale\r\n    // http://www.tannerhelland.com/3643/grayscale-image-algorithm-vb6/\r\n\r\n    // Unsupported algorithm\r\n    if (grayscaleAlgorithms.indexOf(algorithm) === -1) {\r\n        throw new Error('Unsupported grayscale algorithm: ' + algorithm)\r\n    }\r\n\r\n    // None\r\n    if (algorithm === 'none') {\r\n        return null\r\n    }\r\n\r\n    // Get Red/Green/Blue values\r\n    let gray\r\n    let r = data[i];\r\n    let g = data[i + 1];\r\n    let b = data[i + 2];\r\n\r\n    switch (algorithm) {\r\n        case 'average':\r\n            gray = (r + g + b) / 3\r\n            break\r\n\r\n        case 'luma': // Default\r\n            gray = (r * 0.3) + (g * 0.59) + (b * 0.11)\r\n            break\r\n\r\n        case 'luma-601': // CCIR-601\r\n            gray = (r * 0.299) + (g * 0.587) + (b * 0.114)\r\n            break\r\n\r\n        case 'luma-709': // ITU-R-709\r\n            gray = (r * 0.2126) + (g * 0.7152) + (b * 0.0722)\r\n            break\r\n\r\n        case 'luma-240': // SMPTE-240M\r\n            gray = (r * 0.212) + (g * 0.701) + (b * 0.087)\r\n            break\r\n\r\n        case 'desaturation':\r\n            gray = (Math.max(r, g, b) + Math.min(r, g, b)) / 2\r\n            break\r\n\r\n        case 'decomposition-min':\r\n            gray = Math.min(r, g, b)\r\n            break\r\n\r\n        case 'decomposition-max':\r\n            gray = Math.max(r, g, b)\r\n            break\r\n\r\n        case 'red-chanel':\r\n            gray = r\r\n            break\r\n\r\n        case 'green-chanel':\r\n            gray = g\r\n            break\r\n\r\n        case 'blue-chanel':\r\n            gray = b\r\n            break\r\n    }\r\n\r\n    // Shades of gray\r\n    if (shades !== undefined) {\r\n        gray = parseInt(gray / shades) * shades\r\n    }\r\n\r\n    // Force integer\r\n    gray = parseInt(gray)\r\n\r\n    // Set new r/g/b values\r\n    data[i]     = color(gray)\r\n    data[i + 1] = color(gray)\r\n    data[i + 2] = color(gray)\r\n}\r\n\r\n// Apply filters on provided canvas\r\nfunction canvasFilters(canvas, settings) {\r\n    settings = Object.assign({}, {\r\n        smoothing   : false,  // Smoothing [true|fale]\r\n        brightness  : 0,      // Image brightness [-255 to +255]\r\n        contrast    : 0,      // Image contrast [-255 to +255]\r\n        gamma       : 0,      // Image gamma correction [0.01 to 7.99]\r\n        grayscale   : 'none', // Graysale algorithm [average, luma, luma-601, luma-709, luma-240, desaturation, decomposition-[min|max], [red|green|blue]-chanel]\r\n        shadesOfGray: 256,    // Number of shades of gray [2-256]\r\n        invertColor : false,   // Invert color...\r\n        dithering   : false\r\n    }, settings || {})\r\n\r\n    // Get canvas 2d context\r\n    let context = canvas.getContext('2d')\r\n\r\n    // Smoothing\r\n    if (context.imageSmoothingEnabled !== undefined) {\r\n        context.imageSmoothingEnabled = settings.smoothing\r\n    }\r\n    else {\r\n        context.mozImageSmoothingEnabled    = settings.smoothing\r\n        context.webkitImageSmoothingEnabled = settings.smoothing\r\n        context.msImageSmoothingEnabled     = settings.smoothing\r\n        context.oImageSmoothingEnabled      = settings.smoothing\r\n    }\r\n\r\n    // Get image data\r\n    let imageData = context.getImageData(0, 0, canvas.width, canvas.height)\r\n    let data      = imageData.data\r\n\r\n    let contrastFactor, brightnessOffset, gammaCorrection, shadesOfGrayFactor\r\n\r\n    if (settings.contrast !== 0) {\r\n        contrastFactor = (259 * (settings.contrast + 255)) / (255 * (259 - settings.contrast))\r\n    }\r\n\r\n    if (settings.brightness !== 0) {\r\n        brightnessOffset = settings.brightness\r\n    }\r\n\r\n    if (settings.gamma !== 0) {\r\n        gammaCorrection = 1 / settings.gamma\r\n    }\r\n\r\n    // Shades of gray\r\n    if (settings.shadesOfGray > 1 && settings.shadesOfGray < 256) {\r\n        shadesOfGrayFactor = 255 / (settings.shadesOfGray - 1)\r\n    }\r\n\r\n    // For each pixel\r\n    for (let i = 0, il = data.length; i < il; i += 4) {\r\n        // Apply filters\r\n        invertColor(data, i, settings.invertColor)\r\n        brightness(data, i, brightnessOffset)\r\n        contrast(data, i, contrastFactor)\r\n        gamma(data, i, gammaCorrection)\r\n        grayscale(data, i, settings.grayscale, shadesOfGrayFactor)\r\n    }\r\n\r\n    if (settings.dithering) {\r\n        imageData = FloydSteinberg(imageData)\r\n    }\r\n\r\n    // Write new image data on the context\r\n    context.putImageData(imageData, 0, 0)\r\n}\r\n\r\n// Exports\r\nexport { canvasFilters }\r\nexport default canvasFilters\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib/lw.raster2gcode/canvas-filters.js","import canvasFilters from './canvas-filters'\r\n\r\n// CanvasGrid class\r\nclass CanvasGrid {\r\n    // Class constructor...\r\n    constructor(settings) {\r\n        // Init properties\r\n        this.cellSize   = 1024\r\n        this.scaleRatio = { x: 1, y: 1 }\r\n        this.filters    = {}\r\n\r\n        Object.assign(this, settings || {})\r\n\r\n        if (! this.scaleRatio.x) {\r\n            this.scaleRatio = { x: this.scaleRatio, y: this.scaleRatio }\r\n        }\r\n\r\n        this.size   = { width: 0, height: 0, cols: 0, rows: 0 }\r\n        this.file   = null\r\n        this.image  = null\r\n        this.url    = null\r\n        this.canvas = []\r\n        this.pixels = []\r\n    }\r\n\r\n    // <input> can be Image, File, URL object or URL string (http://* or data:image/*)\r\n    load(input) {\r\n        // Load File object\r\n        if (input instanceof File) {\r\n            return this.loadFromFile(input)\r\n        }\r\n\r\n        // Load Image object\r\n        if (input instanceof Image) {\r\n            return this.loadFromImage(input)\r\n        }\r\n\r\n        // Load URL object\r\n        if (typeof input === 'string' || input instanceof URL) {\r\n            return this.loadFromURL(input.trim())\r\n        }\r\n\r\n        // Return rejected promise with an Error object\r\n        return Promise.reject(new Error('Unsupported input format.'))\r\n    }\r\n\r\n    // Load image\r\n    _loadImage(src, reject, resolve) {\r\n        // Create Image object\r\n        let image = new Image()\r\n\r\n        // Register for load and error events\r\n        image.onload = event => {\r\n            this.loadFromImage(image).then(resolve).catch(reject)\r\n        }\r\n\r\n        image.onerror = event => {\r\n            reject(new Error('An error occurred while loading the image : ' + src))\r\n        }\r\n\r\n        // Load the image from File url\r\n        image.src = src\r\n    }\r\n\r\n    // Load from File object\r\n    loadFromFile(input) {\r\n        return new Promise((resolve, reject) => {\r\n            // Bad input type\r\n            if (! (input instanceof File)) {\r\n                reject(new Error('Input param must be a File object.'))\r\n            }\r\n\r\n            // Set input file\r\n            this.file = input\r\n\r\n            // Load image\r\n            this._loadImage(URL.createObjectURL(input), reject, resolve)\r\n        })\r\n    }\r\n\r\n    // Load from URL object or string\r\n    loadFromURL(input) {\r\n        return new Promise((resolve, reject) => {\r\n            // Bad input type\r\n            if (! (input instanceof URL) && typeof input !== 'string') {\r\n                reject(new Error('Input param must be a URL string or object.'))\r\n            }\r\n\r\n            // Create url object\r\n            let url = input instanceof URL ? input : new URL(input)\r\n\r\n            // Set url\r\n            this.url = url\r\n\r\n            // Load image\r\n            this._loadImage(url, reject, resolve)\r\n        })\r\n    }\r\n\r\n    // Load from Image object\r\n    loadFromImage(input) {\r\n        return new Promise((resolve, reject) => {\r\n            // Bad input type\r\n            if (! (input instanceof Image)) {\r\n                reject(new Error('Input param must be a Image object.'))\r\n            }\r\n\r\n            // Set input image\r\n            this.image = input\r\n\r\n            // Process image\r\n            this._processImage()\r\n\r\n            // Resolve the promise\r\n            resolve(this)\r\n        })\r\n    }\r\n\r\n    _processImage() {\r\n        // Reset canvas grid\r\n        this.canvas = []\r\n        this.pixels = []\r\n\r\n        // Calculate grid size\r\n        let width  = Math.round(this.image.width * this.scaleRatio.x)\r\n        let height = Math.round(this.image.height * this.scaleRatio.y)\r\n        let cols   = Math.ceil(width / this.cellSize)\r\n        let rows   = Math.ceil(height / this.cellSize)\r\n\r\n        this.size = { width, height, cols, rows }\r\n\r\n        // Create canvas grid\r\n        let line    = null\r\n        let canvas  = null\r\n        let pixels  = null\r\n        let context = null\r\n\r\n        let x  = null // cols\r\n        let y  = null // rows\r\n        let sx = null // scaled cols\r\n        let sy = null // scaled rows\r\n        let sw = null // scaled width\r\n        let sh = null // scaled height\r\n\r\n        // For each line\r\n        for (y = 0; y < this.size.rows; y++) {\r\n            // Reset current line\r\n            line   = []\r\n            pixels = []\r\n\r\n            // For each column\r\n            for (x = 0; x < this.size.cols; x++) {\r\n                // Create canvas element\r\n                canvas = document.createElement('canvas')\r\n\r\n                // Set canvas size\r\n                if (x === 0 || x < (this.size.cols - 1)) {\r\n                    canvas.width = this.size.width < this.cellSize\r\n                                 ? this.size.width : this.cellSize\r\n                }\r\n                else {\r\n                    // Get the rest for the last item (except the first one)\r\n                    canvas.width = this.size.width % this.cellSize\r\n                }\r\n\r\n                if (y === 0 || y < (this.size.rows - 1)) {\r\n                    canvas.height = this.size.height < this.cellSize\r\n                                  ? this.size.height : this.cellSize\r\n                }\r\n                else {\r\n                    // Get the rest for the last item (except the first one)\r\n                    canvas.height = this.size.height % this.cellSize\r\n                }\r\n\r\n                // Get canvas 2d context\r\n                context = canvas.getContext('2d')\r\n\r\n                // Fill withe background (avoid alpha chanel calculation)\r\n                context.fillStyle = 'white'\r\n                context.fillRect(0, 0, canvas.width, canvas.height)\r\n\r\n                // Draw the part of image in the canvas (scale)\r\n                sw = canvas.width / this.scaleRatio.x\r\n                sh = canvas.height / this.scaleRatio.y\r\n                sx = x * this.cellSize / this.scaleRatio.x\r\n                sy = y * this.cellSize / this.scaleRatio.y\r\n\r\n                context.drawImage(\r\n                    this.image, sx, sy, sw, sh,\r\n                    0, 0, canvas.width, canvas.height\r\n                )\r\n\r\n                // Apply image filters\r\n                canvasFilters(canvas, this.filters)\r\n\r\n                // Add the canvas to current line\r\n                line.push(canvas)\r\n\r\n                // Add the canvas image data to current line\r\n                pixels.push(context.getImageData(0, 0, canvas.width, canvas.height).data)\r\n            }\r\n\r\n            // Add the line to canvas grid\r\n            this.pixels.push(pixels)\r\n            this.canvas.push(line)\r\n        }\r\n    }\r\n\r\n    getPixel(x, y) {\r\n        // Test coords validity\r\n        x = parseInt(x)\r\n        y = parseInt(y)\r\n\r\n        if (isNaN(x) || isNaN(y)) {\r\n            throw new Error('[x, y] params must be Integer.')\r\n        }\r\n\r\n        // Test coords range\r\n        if (x < 0 || x >= this.size.width) {\r\n            throw new Error('Out of range: x = ' + x + ', max: ' + this.size.width)\r\n        }\r\n\r\n        if (y < 0 || y >= this.size.height) {\r\n            throw new Error('Out of range: y = ' + y + ', max: ' + this.size.height)\r\n        }\r\n\r\n        // Calculate target canvas coords\r\n        let col = parseInt(x / this.cellSize)\r\n        let row = parseInt(y / this.cellSize)\r\n\r\n        // Adjuste x/y values relative to canvas origin\r\n        col && (x -= this.cellSize * col)\r\n        row && (y -= this.cellSize * row)\r\n\r\n        // Get pixel data\r\n        let cellSize  = this.cellSize;\r\n\r\n        if (this.size.width < cellSize) {\r\n            cellSize = this.size.width\r\n        }\r\n        else if (this.size.width < cellSize * (col + 1)) {\r\n            cellSize = this.size.width % cellSize\r\n        }\r\n\r\n        let i         = (y * (cellSize * 4)) + (x * 4)\r\n        let pixels    = this.pixels[row][col]\r\n        let pixelData = pixels.slice(i, i + 4)\r\n\r\n        return {\r\n            color : { r: pixelData[0], g: pixelData[1], b: pixelData[2], a: pixelData[3] },\r\n            gray  : (pixelData[0] + pixelData[1] + pixelData[2]) / 3,\r\n            grid  : { col, row },\r\n            coords: { x, y }\r\n        }\r\n    }\r\n}\r\n\r\n// Exports\r\nexport { CanvasGrid }\r\nexport default CanvasGrid\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib/lw.raster2gcode/canvas-grid.js","import CanvasGrid from './canvas-grid'\r\n\r\n// RasterToGcode class\r\nclass RasterToGcode extends CanvasGrid {\r\n    // Class constructor...\r\n    constructor(settings) {\r\n        // Defaults settings\r\n        settings = Object.assign({\r\n            ppi: { x: 254, y: 254 }, // Pixel Per Inch (25.4 ppi == 1 ppm)\r\n\r\n            toolDiameter: 0.1,      // Tool diameter in millimeters\r\n            rapidRate   : 1500,     // Rapid rate in mm/min (G0 F value) nullish value to disable\r\n            feedRate    : 500,      // Feed rate in mm/min (G1 F value)\r\n            rateUnit    : 'mm/min', // Rapid/Feed rate unit [mm/min, mm/sec]\r\n\r\n            beamRange: { min: 0, max: 1 },   // Beam power range (Firmware value)\r\n            beamPower: { min: 0, max: 100 }, // Beam power (S value) as percentage of beamRange\r\n\r\n            milling  : false, // EXPERIMENTAL\r\n            zSafe    : 5,     // Safe Z for fast move\r\n            zSurface : 0,     // Usinable surface (white pixels)\r\n            zDepth   : -10,   // Z depth (black pixels)\r\n            passDepth: 1,     // Pass depth in millimeters\r\n\r\n            offsets  : { X: 0, Y: 0 }, // Global coordinates offsets\r\n            trimLine : true,           // Trim trailing white pixels\r\n            joinPixel: true,           // Join consecutive pixels with same intensity\r\n            burnWhite: true,           // [true = G1 S0 | false = G0] on inner white pixels\r\n            verboseG : false,          // Output verbose GCode (print each commands)\r\n            diagonal : false,          // Go diagonally (increase the distance between points)\r\n            overscan : 0,              // Add some extra white space (in millimeters) before and after each line\r\n\r\n            precision: { X: 2, Y: 2, S: 4 }, // Number of decimals for each commands\r\n\r\n            nonBlocking: true, // Use setTimeout to avoid blocking the UI\r\n\r\n            filters: {\r\n                smoothing   : 0,      // Smoothing the input image ?\r\n                brightness  : 0,      // Image brightness [-255 to +255]\r\n                contrast    : 0,      // Image contrast [-255 to +255]\r\n                gamma       : 0,      // Image gamma correction [0.01 to 7.99]\r\n                grayscale   : 'none', // Graysale algorithm [average, luma, luma-601, luma-709, luma-240, desaturation, decomposition-[min|max], [red|green|blue]-chanel]\r\n                shadesOfGray: 256,    // Number of shades of gray [2-256]\r\n                invertColor : false   // Invert color...\r\n            },\r\n\r\n            onProgress       : null, // On progress callbacks\r\n            onProgressContext: null, // On progress callback context\r\n\r\n            onDone       : null, // On done callback\r\n            onDoneContext: null, // On done callback context\r\n\r\n            onAbort       : null, // On abort callback\r\n            onAbortContext: null  // On abort callback context\r\n        }, settings || {})\r\n\r\n        // Init properties\r\n        super(settings)\r\n\r\n        // Milling settings\r\n        if (this.milling) {\r\n            if (this.zSafe < this.zSurface) {\r\n                throw new Error('\"zSafe\" must be greater to \"zSurface\"')\r\n            }\r\n\r\n            this.passes = Math.abs(Math.floor(this.zDepth / this.passDepth))\r\n        }\r\n\r\n        // Negative beam size ?\r\n        if (this.toolDiameter <= 0) {\r\n            throw new Error('\"toolDiameter\" must be positive')\r\n        }\r\n\r\n        // Uniforme ppi\r\n        if (! this.ppi.x) {\r\n            this.ppi = { x: this.ppi, y: this.ppi }\r\n        }\r\n\r\n        // Calculate PPM = Pixel Per Millimeters\r\n        this.ppm = {\r\n            x: parseFloat((2540 / (this.ppi.x * 100)).toFixed(10)),\r\n            y: parseFloat((2540 / (this.ppi.y * 100)).toFixed(10))\r\n        }\r\n\r\n        // Calculate scale ratio\r\n        this.scaleRatio = {\r\n            x: this.ppm.x / this.toolDiameter,\r\n            y: this.ppm.y / this.toolDiameter\r\n        }\r\n\r\n        // State...\r\n        this.running      = false\r\n        this.gcode        = null\r\n        this.gcodes       = null\r\n        this.currentLine  = null\r\n        this.lastCommands = null\r\n\r\n        // Output size in millimeters\r\n        this.outputSize = { width : 0, height: 0 }\r\n\r\n        // G0 command\r\n        this.G1 = ['G', 1]\r\n        this.G0 = ['G', this.burnWhite ? 1 : 0]\r\n\r\n        // Calculate beam offset\r\n        this.beamOffset = this.toolDiameter * 1000 / 2000\r\n\r\n        // Calculate real beam range\r\n        this.realBeamRange = {\r\n            min: this.beamRange.max / 100 * this.beamPower.min,\r\n            max: this.beamRange.max / 100 * this.beamPower.max\r\n        }\r\n\r\n        // Adjuste feed rate to mm/min\r\n        if (this.rateUnit === 'mm/sec') {\r\n            this.feedRate  *= 60\r\n\r\n            if (this.rapidRate) {\r\n                this.rapidRate *= 60\r\n            }\r\n        }\r\n\r\n        // Register user callbacks\r\n        this._registerUserCallbacks(this)\r\n    }\r\n\r\n    // Register user callbacks\r\n    _registerUserCallbacks(callbacks) {\r\n        // Register user callbacks\r\n        callbacks.onProgress && this.on('progress', callbacks.onProgress, callbacks.onProgressContext)\r\n        callbacks.onAbort && this.on('abort', callbacks.onAbort, callbacks.onAbortContext)\r\n        callbacks.onDone && this.on('done', callbacks.onDone, callbacks.onDoneContext)\r\n    }\r\n\r\n    // Process image\r\n    _processImage() {\r\n        // Call parent method\r\n        super._processImage()\r\n\r\n        // Calculate output size\r\n        this.outputSize = {\r\n            width : this.size.width  * (this.toolDiameter * 1000) / 1000,\r\n            height: this.size.height * (this.toolDiameter * 1000) / 1000\r\n        }\r\n    }\r\n\r\n    // Abort job\r\n    abort() {\r\n        this.running = false\r\n    }\r\n\r\n    // Process image and return gcode string\r\n    run(settings) {\r\n        if (this.running) {\r\n            return\r\n        }\r\n\r\n        // Reset state\r\n        this.running      = true\r\n        this.gcode        = []\r\n        this.gcodes       = []\r\n        this.lastCommands = {}\r\n        this.currentLine  = null\r\n\r\n        // Defaults settings\r\n        settings = settings || {}\r\n\r\n        // Register user callbacks\r\n        this._registerUserCallbacks(settings)\r\n\r\n        // Non blocking mode ?\r\n        let nonBlocking = this.nonBlocking\r\n\r\n        if (settings.nonBlocking !== undefined) {\r\n            nonBlocking = settings.nonBlocking\r\n        }\r\n\r\n        // Add gcode header\r\n        this._addHeader()\r\n\r\n        // Scan type ?\r\n        if (this.diagonal) {\r\n            this._scanDiagonally(nonBlocking)\r\n        }\r\n        else {\r\n            this._scanHorizontally(nonBlocking)\r\n        }\r\n\r\n        if (! nonBlocking) {\r\n            return this.gcode\r\n        }\r\n    }\r\n\r\n    _addHeader() {\r\n        // Base headers\r\n        this.gcode.push(\r\n            '; Generated by LaserWeb (lw.raster-to-gcode.js)',\r\n            '; Size       : ' + this.outputSize.width + ' x ' + this.outputSize.height + ' mm',\r\n            '; PPI        : x: ' + this.ppi.x + ' - y: ' + this.ppi.y,\r\n            '; PPM        : x: ' + this.ppm.x + ' - y: ' + this.ppm.y,\r\n            '; Tool diam. : ' + this.toolDiameter + ' mm',\r\n            '; Feed rate  : ' + this.feedRate + ' ' + this.rateUnit\r\n        )\r\n\r\n        if (this.rapidRate) {\r\n           this.gcode.push('; Rapid rate  : ' + this.rapidRate + ' ' + this.rateUnit)\r\n        }\r\n\r\n        if (this.milling) {\r\n            this.gcode.push(\r\n                '; Z safe     : ' + this.zSafe,\r\n                '; Z surface  : ' + this.zSurface,\r\n                '; Z depth    : ' + this.zDepth\r\n            )\r\n        }\r\n        else {\r\n            this.gcode.push(\r\n                '; Beam range : ' + this.beamRange.min + ' to ' + this.beamRange.max,\r\n                '; Beam power : ' + this.beamPower.min + ' to ' + this.beamPower.max + ' %'\r\n            )\r\n        }\r\n\r\n        // Print activated options\r\n        let options = ['smoothing', 'trimLine', 'joinPixel', 'burnWhite', 'verboseG', 'diagonal']\r\n\r\n        for (var i = options.length - 1; i >= 0; i--) {\r\n            if (! this[options[i]]) {\r\n                options.splice(i, 1)\r\n            }\r\n        }\r\n\r\n        if (options.length) {\r\n            this.gcode.push('; Options    : ' + options.join(', '))\r\n        }\r\n\r\n        // Set feed rates\r\n        this.gcode.push('')\r\n\r\n        if (this.rapidRate) {\r\n           this.gcode.push('G0 F' + this.rapidRate)\r\n        }\r\n\r\n        this.gcode.push('G1 F' + this.feedRate)\r\n        this.gcode.push('')\r\n    }\r\n\r\n    // Map S value to pixel power\r\n    _mapPixelPower(value) {\r\n        let range = this.milling ? { min: 0, max: this.zDepth } : this.realBeamRange\r\n        return value * (range.max - range.min) / 255 + range.min\r\n    }\r\n\r\n    // Compute and return a command, return null if not changed\r\n    _command(name, value) {\r\n        // If the value argument is an object\r\n        if (typeof value === 'object') {\r\n            // Computed commands line\r\n            let commands = Array.prototype.slice.call(arguments)\r\n            let command, line = []\r\n\r\n            // for each command\r\n            for (var i = 0, il = commands.length; i < il; i++) {\r\n                command = this._command.apply(this, commands[i])\r\n                command && line.push(command)\r\n            }\r\n\r\n            // Return the line if not empty\r\n            return line.length ? line.join(' ') : null\r\n        }\r\n\r\n        // Format the value\r\n        value = value.toFixed(this.precision[name] || 0)\r\n\r\n        // If the value was changed or if verbose mode on\r\n        if (this.verboseG || value !== this.lastCommands[name]) {\r\n            this.lastCommands[name] = value\r\n            return name + value\r\n        }\r\n\r\n        // No change\r\n        return null\r\n    }\r\n\r\n    // Get a pixel power value from the canvas data grid\r\n    _getPixelPower(x, y, defaultValue) {\r\n        try {\r\n            // Reverse Y value since canvas as top/left origin\r\n            y = this.size.height - y - 1\r\n\r\n            // Get pixel info\r\n            let pixel = this.getPixel(x, y)\r\n\r\n            // Reversed gray value [ 0 = white | 255 = black ]\r\n            return 255 - pixel.gray\r\n        }\r\n        catch (error) {\r\n            if (arguments.length === 3) {\r\n                return defaultValue\r\n            }\r\n            throw error\r\n        }\r\n    }\r\n\r\n    // Get a point from the current line with real world coordinates\r\n    _getPoint(index) {\r\n        // Get the point object from the current line\r\n        let point = this.currentLine[index]\r\n\r\n        // No point\r\n        if (! point) {\r\n            return null\r\n        }\r\n\r\n        // Commands\r\n        point.G = point.s ? ['G', 1] : this.G0\r\n        point.X = (point.x * this.toolDiameter) + this.offsets.X\r\n        point.Y = (point.y * this.toolDiameter) + this.offsets.Y\r\n        point.S = this._mapPixelPower(point.s)\r\n\r\n        // Offsets\r\n        if (this.diagonal) {\r\n            // Vertical offset\r\n            point.Y += this.toolDiameter\r\n\r\n            // Horizontal offset\r\n            if (point.first || point.lastWhite) {\r\n                point.X += this.beamOffset\r\n                point.Y -= this.beamOffset\r\n            }\r\n            else if (point.last || point.lastColored) {\r\n                point.X -= this.beamOffset\r\n                point.Y += this.beamOffset\r\n            }\r\n        }\r\n        else {\r\n            // Vertical offset\r\n            point.Y += this.beamOffset\r\n\r\n            // Horizontal offset\r\n            if (point.first || point.lastWhite) {\r\n                point.X += this.beamOffset\r\n            }\r\n            else if (point.last || point.lastColored) {\r\n                point.X -= this.beamOffset\r\n            }\r\n        }\r\n\r\n        // Return the point\r\n        return point\r\n    }\r\n\r\n    // Remove all trailing white spaces from the current line\r\n    _trimCurrentLine() {\r\n        // Remove white spaces from the left\r\n        let point = this.currentLine[0]\r\n\r\n        while (point && ! point.p) {\r\n            this.currentLine.shift()\r\n            point = this.currentLine[0]\r\n        }\r\n\r\n        // Remove white spaces from the right\r\n        point = this.currentLine[this.currentLine.length - 2]\r\n\r\n        while (point && ! point.p) {\r\n            this.currentLine.pop()\r\n            point = this.currentLine[this.currentLine.length - 2]\r\n        }\r\n\r\n        // Return the new line length\r\n        return this.currentLine.length\r\n    }\r\n\r\n    // Join pixel with same power\r\n    _reduceCurrentLine() {\r\n        // Line too short to be reduced\r\n        if (this.currentLine.length < 3) {\r\n            return this.currentLine.length\r\n        }\r\n\r\n        // Extract all points exept the first one\r\n        let points = this.currentLine.splice(1)\r\n\r\n        // Get current power\r\n        let power = this.currentLine[0].p\r\n\r\n        // For each extracted point\r\n        for (var point, i = 0, il = points.length - 1; i < il; i++) {\r\n            // Current point\r\n            point = points[i]\r\n\r\n            // On power change\r\n            if (power !== point.p) {\r\n                this.currentLine.push(point)\r\n            }\r\n\r\n            // Update power\r\n            power = point.p\r\n        }\r\n\r\n        // Add last point\r\n        this.currentLine.push(points[i])\r\n    }\r\n\r\n    // Add extra white pixels at the ends\r\n    _overscanCurrentLine(reversed) {\r\n        // Number of pixels to add on each side\r\n        let pixels = this.overscan / this.ppm.x\r\n\r\n        // Get first/last point\r\n        let firstPoint = this.currentLine[0]\r\n        let lastPoint  = this.currentLine[this.currentLine.length - 1]\r\n\r\n        // Is last white/colored point ?\r\n        firstPoint.s && (firstPoint.lastWhite  = true)\r\n        lastPoint.s  && (lastPoint.lastColored = true)\r\n\r\n        // Reversed line ?\r\n        reversed ? (lastPoint.s = 0) : (firstPoint.s = 0)\r\n\r\n        // Create left/right points\r\n        let rightPoint = { x: lastPoint.x + pixels , y: lastPoint.y , s: 0, p: 0 }\r\n        let leftPoint  = { x: firstPoint.x - pixels, y: firstPoint.y, s: 0, p: 0 }\r\n\r\n        if (this.diagonal) {\r\n            leftPoint.y  += pixels\r\n            rightPoint.y -= pixels\r\n        }\r\n\r\n        // Add left/right points to current line\r\n        this.currentLine.unshift(leftPoint)\r\n        this.currentLine.push(rightPoint)\r\n    }\r\n\r\n    // Process current line and return an array of GCode text lines\r\n    _processCurrentLine(reversed) {\r\n        if (this.milling) {\r\n            return this._processMillingLine(reversed)\r\n        }\r\n\r\n        return this._processLaserLine(reversed)\r\n    }\r\n\r\n    // Process current line and return an array of GCode text lines\r\n    _processMillingLine(reversed) {\r\n        // Skip empty line\r\n        if (! this._trimCurrentLine()) {\r\n            return null\r\n        }\r\n\r\n        // Join pixel with same power\r\n        if (this.joinPixel) {\r\n            this._reduceCurrentLine()\r\n        }\r\n\r\n        // Mark first and last point on the current line\r\n        this.currentLine[0].first = true\r\n        this.currentLine[this.currentLine.length - 1].last = true\r\n\r\n        // Reversed line ?\r\n        if (reversed) {\r\n            this.currentLine = this.currentLine.reverse()\r\n        }\r\n\r\n        // Point index\r\n        let point, index = 0\r\n\r\n        // Init loop vars...\r\n        let command, gcode = []\r\n\r\n        let addCommand = (...args) => {\r\n            command = this._command(...args)\r\n            command && gcode.push(command)\r\n        }\r\n\r\n        // Get first point\r\n        point = this._getPoint(index)\r\n\r\n        let plung = false\r\n        let Z, zMax\r\n\r\n        let pass = (passNum) => {\r\n            // Move to start of the line\r\n            addCommand(['G', 0], ['Z', this.zSafe])\r\n            addCommand(['G', 0], ['X', point.X], ['Y', point.Y])\r\n            addCommand(['G', 0], ['Z', this.zSurface])\r\n\r\n            // For each point on the line\r\n            while (point) {\r\n                if (point.S) {\r\n                    if (plung) {\r\n                        addCommand(['G', 0], ['Z', this.zSurface])\r\n                        plung = false\r\n                    }\r\n\r\n                    Z    = point.S\r\n                    zMax = this.passDepth * passNum\r\n\r\n                    // Last pass\r\n                    if (passNum < this.passes) {\r\n                        Z = Math.max(Z, -zMax)\r\n                    }\r\n\r\n                    addCommand(['G', 1], ['Z', this.zSurface + Z])\r\n                    addCommand(['G', 1], ['X', point.X], ['Y', point.Y])\r\n                }\r\n                else {\r\n                    if (plung) {\r\n                        addCommand(['G', 1], ['Z', this.zSurface])\r\n                        plung = false\r\n                    }\r\n\r\n                    addCommand(['G', 0], ['Z', this.zSafe])\r\n                    addCommand(['G', 0], ['X', point.X], ['Y', point.Y])\r\n                }\r\n\r\n                if (point.lastWhite || point.lastColored) {\r\n                    plung = true\r\n                }\r\n\r\n                // Get next point\r\n                point = this._getPoint(++index)\r\n            }\r\n\r\n            // Move to Z safe\r\n            addCommand(['G', 1], ['Z', this.zSurface])\r\n            addCommand(['G', 0], ['Z', this.zSafe])\r\n        }\r\n\r\n        for (var i = 1; i <= this.passes; i++) {\r\n            pass(i)\r\n\r\n            if (! gcode.length) {\r\n                break\r\n            }\r\n\r\n            if (this.gcodes.length < i) {\r\n                this.gcodes.push([])\r\n            }\r\n            else {\r\n                this.gcodes[i - 1].push.apply(this.gcodes[i - 1], gcode)\r\n            }\r\n\r\n            index = 0\r\n            gcode = []\r\n            point = this._getPoint(index)\r\n\r\n            this.lastCommands = {}\r\n        }\r\n\r\n        // Not sure what to return...\r\n        return null\r\n    }\r\n\r\n    // Process current line and return an array of GCode text lines\r\n    _processLaserLine(reversed) {\r\n        // Trim trailing white spaces ?\r\n        if (this.trimLine && ! this._trimCurrentLine()) {\r\n            // Skip empty line\r\n            return null\r\n        }\r\n\r\n        // Join pixel with same power\r\n        if (this.joinPixel) {\r\n            this._reduceCurrentLine()\r\n        }\r\n\r\n        // Overscan ?\r\n        if (this.overscan) {\r\n            this._overscanCurrentLine(reversed)\r\n        }\r\n\r\n        // Mark first and last point on the current line\r\n        this.currentLine[0].first = true\r\n        this.currentLine[this.currentLine.length - 1].last = true\r\n\r\n        // Reversed line ?\r\n        if (reversed) {\r\n            this.currentLine = this.currentLine.reverse()\r\n        }\r\n\r\n        // Point index\r\n        let point, index = 0\r\n\r\n        // Init loop vars...\r\n        let command, gcode = []\r\n\r\n        let addCommand = (...args) => {\r\n            command = this._command(...args)\r\n            command && gcode.push(command)\r\n        }\r\n\r\n        // Get first point\r\n        point = this._getPoint(index)\r\n\r\n        // Move to start of the line\r\n        addCommand(this.G0, ['X', point.X], ['Y', point.Y], ['S', 0])\r\n\r\n        // Get next point\r\n        point = this._getPoint(++index)\r\n\r\n        // For each point on the line\r\n        while (point) {\r\n            // Burn to next point\r\n            addCommand(point.G, ['X', point.X], ['Y', point.Y], ['S', point.S])\r\n\r\n            // Get next point\r\n            point = this._getPoint(++index)\r\n        }\r\n\r\n        // Return gcode commands array\r\n        if (gcode.length) {\r\n            return gcode\r\n        }\r\n\r\n        // Empty line\r\n        return null\r\n    }\r\n\r\n    // Parse horizontally\r\n    _scanHorizontally(nonBlocking) {\r\n        // Init loop vars\r\n        let x = 0, y = 0\r\n        let s, p, point, gcode\r\n        let w = this.size.width\r\n        let h = this.size.height\r\n\r\n        let reversed    = false\r\n        let lastWhite   = false\r\n        let lastColored = false\r\n\r\n        let computeCurrentLine = () => {\r\n            // Reset current line\r\n            this.currentLine = []\r\n\r\n            // Reset point object\r\n            point = null\r\n\r\n            // For each pixel on the line\r\n            for (x = 0; x <= w; x++) {\r\n                // Get pixel power\r\n                s = p = this._getPixelPower(x, y, p)\r\n\r\n                // Is last white/colored pixel\r\n                lastWhite   = point && ! point.p && p\r\n                lastColored = point && point.p && ! p\r\n\r\n                // Pixel color from last one on normal line\r\n                if (! reversed && point) {\r\n                    s = point.p\r\n                }\r\n\r\n                // Create point object\r\n                point = { x: x, y: y, s: s, p: p }\r\n\r\n                // Set last white/colored pixel\r\n                lastWhite   && (point.lastWhite   = true)\r\n                lastColored && (point.lastColored = true)\r\n\r\n                // Add point to current line\r\n                this.currentLine.push(point)\r\n            }\r\n        }\r\n\r\n        let percent     = 0\r\n        let lastPercent = 0\r\n\r\n        let processCurrentLine = () => {\r\n            // Process pixels line\r\n            gcode = this._processCurrentLine(reversed)\r\n\r\n            // Call progress callback\r\n            percent = Math.round((y / h) * 100)\r\n\r\n            if (percent > lastPercent) {\r\n                this._onProgress({ gcode, percent })\r\n            }\r\n\r\n            lastPercent = percent\r\n\r\n            // Skip empty gcode line\r\n            if (! gcode) {\r\n                return\r\n            }\r\n\r\n            // Toggle line state\r\n            reversed = ! reversed\r\n\r\n            // Concat line\r\n            this.gcode.push.apply(this.gcode, gcode)\r\n        }\r\n\r\n        let processNextLine = () => {\r\n            // Aborted ?\r\n            if (! this.running) {\r\n                return this._onAbort()\r\n            }\r\n\r\n            // Process line...\r\n            computeCurrentLine()\r\n            processCurrentLine()\r\n\r\n            y++\r\n\r\n            if (y < h) {\r\n                if (nonBlocking) {\r\n                    setTimeout(processNextLine, 0)\r\n                }\r\n                else {\r\n                    processNextLine()\r\n                }\r\n            }\r\n            else {\r\n                if (this.milling) {\r\n                    this.gcodes.forEach(gcode => {\r\n                        this.gcode.push.apply(this.gcode, gcode)\r\n                    })\r\n                }\r\n\r\n                this._onDone({ gcode: this.gcode })\r\n                this.running = false\r\n            }\r\n        }\r\n\r\n        processNextLine()\r\n    }\r\n\r\n    // Parse diagonally\r\n    _scanDiagonally(nonBlocking) {\r\n        // Init loop vars\r\n        let x = 0, y = 0\r\n        let s, p, point, gcode\r\n        let w = this.size.width\r\n        let h = this.size.height\r\n\r\n        let totalLines  = w + h - 1\r\n        let lineNum     = 0\r\n        let reversed    = false\r\n        let lastWhite   = false\r\n        let lastColored = false\r\n\r\n        let computeCurrentLine = (x, y) => {\r\n            // Reset current line\r\n            this.currentLine = []\r\n\r\n            // Reset point object\r\n            point = null\r\n\r\n            // Increment line num\r\n            lineNum++\r\n\r\n            while(true) {\r\n                // Y limit reached !\r\n                if (y < -1 || y == h) {\r\n                    break\r\n                }\r\n\r\n                // X limit reached !\r\n                if (x < 0 || x > w) {\r\n                    break\r\n                }\r\n\r\n                // Get pixel power\r\n                s = p = this._getPixelPower(x, y, p)\r\n\r\n                // Is last white/colored pixel\r\n                lastWhite   = point && (! point.p && p)\r\n                lastColored = point && (point.p && ! p)\r\n\r\n                // Pixel color from last one on normal line\r\n                if (! reversed && point) {\r\n                    s = point.p\r\n                }\r\n\r\n                // Create point object\r\n                point = { x: x, y: y, s: s, p: p }\r\n\r\n                // Set last white/colored pixel\r\n                lastWhite   && (point.lastWhite   = true)\r\n                lastColored && (point.lastColored = true)\r\n\r\n                // Add the new point\r\n                this.currentLine.push(point)\r\n\r\n                // Next coords\r\n                x++\r\n                y--\r\n            }\r\n        }\r\n\r\n        let percent     = 0\r\n        let lastPercent = 0\r\n\r\n        let processCurrentLine = () => {\r\n            // Process pixels line\r\n            gcode = this._processCurrentLine(reversed)\r\n\r\n            // Call progress callback\r\n            percent = Math.round((lineNum / totalLines) * 100)\r\n\r\n            if (percent > lastPercent) {\r\n                this._onProgress({ gcode, percent })\r\n            }\r\n\r\n            lastPercent = percent\r\n\r\n            // Skip empty gcode line\r\n            if (! gcode) {\r\n                return\r\n            }\r\n\r\n            // Toggle line state\r\n            reversed = ! reversed\r\n\r\n            // Concat line\r\n            this.gcode.push.apply(this.gcode, gcode)\r\n        }\r\n\r\n        let processNextLine = () => {\r\n            // Aborted ?\r\n            if (! this.running) {\r\n                return this._onAbort()\r\n            }\r\n\r\n            // Process line...\r\n            computeCurrentLine(x, y)\r\n            processCurrentLine()\r\n\r\n            if (! x) y++\r\n            else x++\r\n\r\n            if (y === h) {\r\n                x++\r\n                y--\r\n            }\r\n\r\n            if (y < h && x < w) {\r\n                if (nonBlocking) {\r\n                    setTimeout(processNextLine, 0)\r\n                }\r\n                else {\r\n                    processNextLine()\r\n                }\r\n            }\r\n            else {\r\n                this._onDone({ gcode: this.gcode })\r\n                this.running = false\r\n            }\r\n        }\r\n\r\n        processNextLine()\r\n    }\r\n\r\n    _onProgress(event) {\r\n        //console.log('progress:', event.percent)\r\n    }\r\n\r\n    _onDone(event) {\r\n        //console.log('done:', event.gcode.length)\r\n    }\r\n\r\n    _onAbort() {\r\n        //console.log('abort')\r\n    }\r\n\r\n    on(event, callback, context) {\r\n        let method = '_on' + event[0].toUpperCase() + event.slice(1)\r\n\r\n        if (! this[method] || typeof this[method] !== 'function') {\r\n            throw new Error('Undefined event: ' + event)\r\n        }\r\n\r\n        this[method] = event => callback.call(context || this, event)\r\n\r\n        return this\r\n    }\r\n\r\n    // Return the bitmap height-map\r\n    getHeightMap(settings) {\r\n        if (this.running) {\r\n            return\r\n        }\r\n\r\n        // Init loop vars\r\n        this.running  = true\r\n        let heightMap = []\r\n\r\n        let x = 0\r\n        let y = 0\r\n        let w = this.size.width\r\n        let h = this.size.height\r\n\r\n        let percent     = 0\r\n        let lastPercent = 0\r\n\r\n        // Defaults settings\r\n        settings = settings || {}\r\n\r\n        // Register user callbacks\r\n        this._registerUserCallbacks(settings)\r\n\r\n        // Non blocking mode ?\r\n        let nonBlocking = this.nonBlocking\r\n\r\n        if (settings.nonBlocking !== undefined) {\r\n            nonBlocking = settings.nonBlocking\r\n        }\r\n\r\n        let computeCurrentLine = () => {\r\n            // Reset current line\r\n            let pixels = []\r\n\r\n            // For each pixel on the line\r\n            for (x = 0; x < w; x++) {\r\n                pixels.push(this._mapPixelPower(this._getPixelPower(x, y)))\r\n            }\r\n\r\n            // Call progress callback\r\n            percent = Math.round((y / h) * 100)\r\n\r\n            if (percent > lastPercent) {\r\n                //onProgress.call(settings.progressContext || this, { pixels, percent })\r\n                this._onProgress({ pixels, percent })\r\n            }\r\n\r\n            lastPercent = percent\r\n\r\n            // Add pixels line\r\n            heightMap.push(pixels)\r\n        }\r\n\r\n        let processNextLine = () => {\r\n            // Aborted ?\r\n            if (! this.running) {\r\n                return this._onAbort()\r\n            }\r\n\r\n            // Process line...\r\n            computeCurrentLine()\r\n\r\n            y++\r\n\r\n            if (y < h) {\r\n                if (nonBlocking) {\r\n                    setTimeout(processNextLine, 0)\r\n                }\r\n                else {\r\n                    processNextLine()\r\n                }\r\n            }\r\n            else {\r\n                //onDone.call(settings.doneContext || this, { heightMap })\r\n                this._onDone({ heightMap })\r\n                this.running = false\r\n            }\r\n        }\r\n\r\n        processNextLine()\r\n\r\n        if (! nonBlocking) {\r\n            return heightMap\r\n        }\r\n    }\r\n}\r\n\r\n// Exports\r\nexport { RasterToGcode }\r\nexport default RasterToGcode\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib/lw.raster2gcode/raster-to-gcode.js","/*\n * floyd-steinberg\n *\n * Using 2D error diffusion formula published by Robert Floyd and Louis Steinberg in 1976\n *\n * Javascript implementation of Floyd-Steinberg algorithm thanks to Forrest Oliphant @forresto and @meemoo \n * via iFramework https://github.com/meemoo/iframework/blob/master/src/nodes/image-monochrome-worker.js\n *\n * Accepts an object that complies with the HTML5 canvas imageData spec https://developer.mozilla.org/en-US/docs/Web/API/ImageData\n * In particular, it makes use of the width, height, and data properties\n *\n * License: MIT\n*/\n\nmodule.exports = floyd_steinberg;\n\nfunction floyd_steinberg(image) {\n  var imageData = image.data;\n  var imageDataLength = imageData.length;\n  var w = image.width;\n  var lumR = [],\n      lumG = [],\n      lumB = [];\n\n  var newPixel, err;\n\n  for (var i = 0; i < 256; i++) {\n    lumR[i] = i * 0.299;\n    lumG[i] = i * 0.587;\n    lumB[i] = i * 0.110;\n  }\n\n  // Greyscale luminance (sets r pixels to luminance of rgb)\n  for (var i = 0; i <= imageDataLength; i += 4) {\n    imageData[i] = Math.floor(lumR[imageData[i]] + lumG[imageData[i+1]] + lumB[imageData[i+2]]);\n  }\n\n  for (var currentPixel = 0; currentPixel <= imageDataLength; currentPixel += 4) {\n    // threshold for determining current pixel's conversion to a black or white pixel\n    newPixel = imageData[currentPixel] < 150 ? 0 : 255;\n    err = Math.floor((imageData[currentPixel] - newPixel) / 23);\n    imageData[currentPixel] = newPixel;\n    imageData[currentPixel + 4         ] += err * 7;\n    imageData[currentPixel + 4 * w - 4 ] += err * 3;\n    imageData[currentPixel + 4 * w     ] += err * 5;\n    imageData[currentPixel + 4 * w + 4 ] += err * 1;\n    // Set g and b pixels equal to r (effectively greyscales the image fully)\n    imageData[currentPixel + 1] = imageData[currentPixel + 2] = imageData[currentPixel];\n  }\n\n  return image;\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/floyd-steinberg/floyd-steinberg.js\n// module id = 4\n// module chunks = 0"],"sourceRoot":""}